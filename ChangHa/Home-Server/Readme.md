# Home Server
> https://www.opentutorials.org/course/3265

## 0. Topic
> 가정 공유기를 사용해 서버를 운영하는 방법을 배워보자  
### 인터넷에 대한 핵심 지식
- IP주소 - IPv4, IPv6
- NAT, Public/Private IP Address, Port Forwarding, Dynamic/Static IP address, Dynamic DNS등의 개념을 알아야 공유기를 웹 서버로 이용할 수 있다
- 여기서는 **IP, NAT, DHCP, Port Forwarding**에 대해 알아보자

## 1. 공유기(router)
> 하나의 IP로 여러 기기들이 인터넷에 접속할 수 있도록 하는 통신장비  
### 공유기란?
- IP주소란? 인터넷상에서 통신을 하기 위한 주소 / 인터넷을 사용하려면 IP주소가 부여되어야 한다
- 컴퓨터/스마트폰/노트북 등 **여러 기기가 인터넷에 접속되기 위해**선 여러회선이 필요하다 - 비싸  
-> **공유기**라는 기기를 이용함
- 공유기 포트는 **wan/lan**으로 구분됨. **통신사로부터 받아온 회선은 wan**에 꽂히고(전 세계가 연결된 광역 네트워크인 인터넷에 연결되어있는거임 - **Wide Area Network**), **집의 기기들은 lan**과 연결되어 인터넷에 접속된다 (**공유기를 중심으로 '같은 지역 네트워크'에 묶여있다 - Local Area Network**)  
=> 공유기는 LAN네트워크와 WAN네트워크 사이의 중개자 이다.
- LAN네트워크에 기기들이 공요기와 연결되는 순간 핸드폰/컴퓨터에 IP주소가 부여된다 (DHCP)
- 근데 **공유기도 LAN네트워크의 일부** 이므로, 똑같이 IP주소가 부여된다   
- - **공유기 는 해당 LAN의 '입구'**이므로 요놈의 IP에는 특별히 **'GateWay Address'라는 이름을 부여**받는다 or **Router Adress**
- **WAN**에 속한 IP주소는 인터넷 상 누구나 접속 가능하므로 **'Public IP address'**
- **LAN**에 속한 IP주소는 안에서만 쓸 수 있기 때문에 **'Private IP address'** 
- - IPv4체계에서 PrivateIP로만 쓰기로 약속한 주소들이 정해져 있음 / 10.0.0.0~10.255.255.255 / 172.16.0.0~172.31.255.255 / 192.168.0.0~192.168.255.255

## 2. NAT(Network Address Translation)
> **[---WAN---59.6.66.238-ROUTER-192.168.0.1(GateWay)---LAN---192.168.0.4(MY COM)]**  
> 위와 같은 네트워크 상황에서 *MY COM이 위키피디아에 접속*하려면 어떤 일들이 일어나야 할까 생각해봅시다  
1. MY COM이 GateWay IP에다가 위키피디아 있니? 라고 물어봄
- - 만약 LAN에 속해 있으면 그냥 거기로 요청을 다시 보냄
- - 만약 LAN에 없다면 WAN에 있다는 것이니, 밖으로 요청을 보내야함
2. WAN에 요청을 보내기 전에 공유기가 하는 두 가지 작업
- 요청을 보낸놈의 **private IP를 공유기에 기록**함 - 'MY COM이 보냄.'
- 요청에 포함된 192.168.0.4라는 **private IP를 59.6.66.238이라는 public IP로 바꿔준다** - **'NAT'**
3. 바뀐 주소가 담긴 요청을 WAN에 있는 위키피디아로 보냄
4. 위키피디아는 응답을 59.6.66.238로 보냄 (수정해서 보냈었으니깐!)
5. 공유기는 응답받은 정보를 보고, 이 응답이 192.168.0.4의 요청에 대한 응답임을 파악하고 응답을 전해줌 (요청보내기 전에 저장해놓는다고 했자나)
---> 이건... private IP를 '웹 클라이언트'로 사용하기 위한 NAT사용법...! -> 다음번엔 요놈을 '웹 서버'로 사용하기위한 NAT사용법을 알아보자!!!! (마음에 걸리는 것 - 웹서버클라이언트 통신과, 웹이아닌서버클라이언트 통신의 차이?)
### 그래서 NAT(Network Address Traslation)란?
> **private IP와 public IP를 매칭해서 교환해주는 것**

## 3. 내 컴퓨터의 IP주소 알아내기(window OS)
> [---WAN---59.6.66.238-ROUTER-192.168.0.1(GateWay)---LAN---192.168.0.4(MY COM)]  
1. 우리집 LAN의 IP (내 기기 / Gateway)
2. 우리집이 외부에 나갈때 보이는 Public IP
(window OS) - 제어판 - 네트워크와공유센터('연결'항목에 이더넷=유선연결, 와이파이=무선연결 이라고보면 됨) - 해당 연결 항목 클릭 - '자세히...' 클릭  
-> IPv4: 기기에 부여된 IP주소(192.168.0.4) / IPv4 Default GateWay: LAN에서 라우터의 IP주소(192.168.0.1) /   
  
  
이제 내 기기에서 라우터로 접속 해보자: 
**브라우져에 '라우터의 IP주소'를 입력**하면 해당 **공유기의 설정 페이지**로 넘어감   
- 관리도구 - 여러가지 설정을 할 수 있음   
- -> '시스템 요약 정보'항목을 보면 '외부 IP주소'와 '내부 IP주소(192.168.0.1)'를 확인할 수 있음
- -> 여기서 외부 IP주소가 바로 WAN에 속한 라우터 주소(59.6.66.238)임


## 4. 포트(PORT)
> **외부에서 온 요청이 해당 기기의 어느 응용프로그램에 도달해야 하는가?**  

지금까지는 내 기기를 Client로 이용할 때 필요한 정보를 봤다. 지금부터는 내 기기를 '서버'로 이용할 때 필요한 정보를 알아보자. 가장 중요한 개념은 **'port'**다!
- 외부 기기는 공유기의 public IP로 접근한다. 그런데 이 기기는 공유기에 연결된 **수 많은 내부 기기 중 어느 기기**에 도달해야 하는가? **어떻게 도달**할 수 있는가? 공유기가 이를 **어떻게 '교환**해 줄 수 있는가?' 이를 위해선 **Port Forwarding**의 개념을 알아야하고, 이걸 알기위해선 **Port의 개념**을 알아야한다.  

- 하나의 컴퓨터에는 웹 **서버(뿐 아니라 여러 서버도) 여러개 설치**되어 있을 수 있다. 이 서버들을 어떻게 식별할까?
-> 이를 위한 **식별자가 바로 Port**다
- port번호는 0~65535   
- - / 0~1023은 Well-Known port(예약 포트) 22는SSH, 80은 http(웹)가 쓰도록 정해져 있음   
- - -> 웹 서버를 올리면 기본적으로 80번 port에서 Listen하도록 된다(**서버가 port에서 클라이언트를 기다리는 것**을 **'Listen'**이라고 표현함)   
- - / 1024~65535는 맘대로 써도 되는 port, 만약 이미 웹서버가 대기중인데 하나 더 올리고 싶다면 8080port를 쓰면 됨 (8080이란 숫자는 관습적인 숫자임)  

- **URL: 어떤 서버에 접속할 것인지 경로를 기입하는 것**임
- - 만약 public IP가 123.123.123.123인 기기의 80포트에서 대기중인 http서버에 접속하고 싶다면
- - -> http://123.123.123.123:80/
- - 만약 만약 public IP가 123.123.123.123인 기기의 8080포트에서 대기중인 http서버에 접속하고 싶다면
- - -> http://123.123.123.123:8080/
으로 접속하면 됨 (브라우져나 뭐 다른 프로그램을 사용해서)

## 5. 포트 포워딩(PORT FORWARDING)
> **공유기의 port에 호스트의 port를 매칭하는 것**  

[---WAN---59.6.66.238-ROUTER-192.168.0.1(GateWay)---LAN---192.168.0.4(MY COM)]  

공유기 외부에서 공유기 내부로 접속하기 위해선 **'공유기의 몇 번 port에 공유기가 부여한 private IP의 몇 번 port로 연결해 줄 것인지'를 공유기가 알고 있어야 함**
- 그럼 공유기가 뭘 알고 있다는 거야아아아아아? **(public:port -> private:port)**
- - 59.6.66.238:8081 -> 192.168.0.4:80 이런식의 매칭을 공유기가 기록해서 가지고 있는거임
- 그럼 이걸 어떻게 지정해줌?
- - 브라우져에서 gateway 주소 입력하고 들어갔던 공유기 관리 페이지 기억남? (3에 있음)
- - -> 거기서 'NAT/라우터관리'>'포트포워드 설정'에 들어가서 입력해놓으면 됨 ㅋ (window os)
- - 이렇게 하면 해당 포트포워딩 설정이 '공유기'에 저장되고, 공유기는 public IP의 어떠한 port로 들어온 요청을 매칭된 private IP의 port로 라우트(경로 설정) 해주는 거임 ㅋㅋㅋㅋㅋㅋㅋㅋㅋ 대박 ㅋㅋㅋㅋㅋㅋㅋ
- - -> 내가 내 기기(1992.168.0.4)의 8080port에 웹 서버를 띄워 놓아도 내 친구가 접속할 수 있다는 놀라운 사실적인 사실!!!!

## 6. 유동IP와 고정IP(Dynamic / Static)
가정에서 서버를 운영하는 것이 어려운 이유 -> **통신사로부터 제공받은 IP주소가 바뀜...**
왜 변경되고, 어떻게 고정할 수 있을지 알아보자!
- ISP(Internet Service Provider)가 모오오오오든 집집마다 public IP를 제공해주면, 이 IP가 부족해진다
- 그래서 **'IP주소 돌려막기'**기법을 이용함 (지금 인터넷을 사용하고있지 않은 가정의 public IP를 회수해서, 새로운 가입자한 테 주고, 회수하고 주고, 회수하고 주고... 이런식으로...)
- -> IP가 동적으로 계속 바뀜 ㅠ **Dynamic IP Address**
  
그럼 정적인 IP를 사용하기 위해서는 어떻게 해야됨?  
-> ...Static IP를 구매해야됨 ㅅㅂ 다른 방법이 없음

## 7.  DHCP(Dynamic Host Configuration Protocol)
내  IP주소를 변경하는 방법을 알아보고, 이가 얼마나 까다로운지 알게 될 것이며, 이 과정에서 **DHCP프로토콜**이 무엇인지 알아보도록 하자
### private IP를 수동으로 입력하는 방법( window OS )
- 제어판 - 네트워크및공유센터 - 이더넷(혹은 와이파이)클릭 - 속성 - Internet Protocol Version 4(TCP/IPv4) 누르고 속성 
- - -> 아마 'Obtain an IP address automatically' 가 check되어 있을 거임. 이제 check풀고 아래에 쓰고싶은 **IP address / Subnet mask / Default gateway**를 입력하면 됨 (Subnet Mask가 뭔지는 아직 공부 안함) 
- - 또 DNS server address를 직접 입력해줘야함 (DNS가 뭔지 안배움 ㅋㅋㅋㅋ 이것도 공부해야됨)
  

### DHCP라는 규약
> IP등등을 자동으로 해주기 위한 약속  
- DHCP를 사용하기 위해서는 'DHCP server'라는 프로그램이 필요함
- 보오통 **공유기는 이 DHCP server를 내장**하고 있음
- 보오통 **인터넷을 사용하는 기기에는 'DHCP client'를 내장**하고 있음
- 기기가 공유기와 LAN으로 연결되면, DHCP client가 DHCP server로 mac주소와 함께 요청을 보낸다. 
- -> 그러면 server는 가용 IP와 함께 응답해주고, client는 잘 받았다고 응답해준다. 
- -> 그러면 server는 응답을 잘 받았다는 응답을 client에게 보내주고, 
- -> 이 응답을 받으면 client는 빌린 ip와 여러가지 정보를 세팅하게 된다.

자, 이제 이론을 알았으니 실제로 그러한가 살펴보자  
--- 공유기관리페이지 - 고급설정 - 네트워크관리 - 내부네트워크설정 에 들어가면 실제로 DHCP서버에 등록된 주소나 사용중인 주소가 기입되어 있다!!!  

--- 

## 더 공부하면 할 만한 것들
+ **NAS(Networked Attached Storage)** -> web-hard서비스를 직접 윤용 기능
+ IP가 아닌 **Domain이름으로 접근가능한 서버**를 만들수도 있지요 (IP가 바뀌어도 Domain이름으로 서버에 접속할 수 있지 / freenom.com을 이용하면 1년간은 무료임 ) - DDNS를 이용하면 고정IP를 가진것과 비슷한 효과를 낼 수 있음
+ 보안과 관련해서, **https**를 이용하면 안전한 웹서버를 운영할 수 있다(https도 무료화 되었음 ㅇㅇ) - 만약 사용자의 개인정보를 저장하고 있다면 https를 이용해야함 (Let's encript같은 서비스를 이용하면 인증서를 무료로 발급받을 수 있다)
+ 웹 서버를 제공해주는 **'web hosting'**, 일반적인 서버를 제공해주는 **'server hosting'**, 큰 규모로 여러 편의기능을 제공하는 **'cloud computing'**등의 업체를 통해서 서비스를 운용해볼 수 있다
